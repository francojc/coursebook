<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Acquire data | Coursebook</title>
<meta name="author" content="Jerid Francom">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Embed Hypothes.is --><script src="https://hypothes.is/embed.js" async></script><!-- Google Analytics --><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-57189160-3', 'auto');
      ga('send', 'pageview');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="assets/bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Text as Data: An introduction to quantative text analysis and reproducible research with R">Coursebook</a>:
        <small class="text-muted">Text as Data: An introduction to quantative text analysis and reproducible research with R</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">Foundations</li>
<li><a class="" href="foundations-overview.html">Overview</a></li>
<li><a class="" href="data-language-and-text-analysis.html"><span class="header-section-number">1</span> Data, language, and text analysis</a></li>
<li class="book-part">Orientation</li>
<li><a class="" href="orientation-overview.html">Overview</a></li>
<li><a class="" href="understanding-data.html"><span class="header-section-number">2</span> Understanding data</a></li>
<li><a class="" href="approaching-analysis.html"><span class="header-section-number">3</span> Approaching analysis</a></li>
<li><a class="" href="framing-research.html"><span class="header-section-number">4</span> Framing research</a></li>
<li class="book-part">Preparation</li>
<li><a class="" href="preparation-overview.html">Overview</a></li>
<li><a class="active" href="acquire-data.html"><span class="header-section-number">5</span> Acquire data</a></li>
<li><a class="" href="curate-data.html"><span class="header-section-number">6</span> Curate data</a></li>
<li><a class="" href="transform-data.html"><span class="header-section-number">7</span> Transform data</a></li>
<li class="book-part">Modeling</li>
<li><a class="" href="modeling-overview.html">Overview</a></li>
<li><a class="" href="inference.html"><span class="header-section-number">8</span> Inference</a></li>
<li><a class="" href="prediction.html"><span class="header-section-number">9</span> Prediction</a></li>
<li><a class="" href="exploration.html"><span class="header-section-number">10</span> Exploration</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="section-3.html"><span class="header-section-number">A</span> …</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/lin380/coursebook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="acquire-data" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Acquire data<a class="anchor" aria-label="anchor" href="#acquire-data"><i class="fas fa-link"></i></a>
</h1>
<p style="font-weight:bold; color:red;">
INCOMPLETE DRAFT
</p>
<blockquote>
<p>The scariest moment is always just before you start.</p>
<p>―–Stephen King</p>
</blockquote>
<div class="rmdkey">
<p>
In this chapter you will learn:
</p>
<ul>
<li>
the goals of this textbook
</li>
<li>
the reasoning for using the R programming language
</li>
<li>
important text conventions employed in this textbook
</li>
</ul>
</div>
<!-- COURSE STRUCTURE

TUTORIALS:

- Primers: 
  - Introduction to Iteration: https://rstudio.cloud/learn/primers/5.1
  - Write Functions: https://rstudio.cloud/learn/primers/6
    - Function basics
    - How to Write a Function
    - Arguments

SWIRL:

- ...

WORKED/ RECIPE:

- ...

PROJECT:

- ...

GOALS:

...

-->
<p>Overview… (edit)</p>
<p>I will provide an overview of the first of three common strategies for acquiring corpus data in R: accessing corpus data from data repositories and individual sites. I will cover acquiring data from different sources and introduce you to the R code that will help speed the process, maintain consistency in our data, and set the stage for a reproducible workflow.</p>
<p>There are three main ways to acquire corpus data using R that I will introduce you to: <strong>direct download</strong>, <strong>package interfaces</strong>, and <strong>web scraping</strong>. In this chapter we will start by directly downloading a corpus as it is the most straightforward process for the novice R programmer and incurs the least number of steps. Along the way I will introduce some key R coding concepts including control statements and custom functions.</p>
<div id="direct-downloads" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Direct downloads<a class="anchor" aria-label="anchor" href="#direct-downloads"><i class="fas fa-link"></i></a>
</h2>
<p>Scenarios</p>
<ol style="list-style-type: decimal">
<li>File download</li>
<li>Compressed file download</li>
</ol>
<hr>
<p>Let’s take a look at how this works starting with the a sample from the Switchboard Corpus, a corpus of 2,400 telephone conversations by 543 speakers. First we navigate to the site with a browser and download the file that we are looking for. In this case I found the Switchboard Corpus on the <a href="http://www.nltk.org/nltk_data/">NLTK data repository site</a>. More often than not this file will be some type of compressed archive file with an extension such as <code>.zip</code> or <code>.tz</code>, which is the case here. Archive files make downloading multiple files easy by grouping files and directories into one file. In R we can used the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function from the base R library<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Remember base R packages are installed by default with R and are loaded and accessible by default in each R session.&lt;/p&gt;"><sup>14</sup></a>. There are a number of <strong>arguments</strong> that a function may require or provide optionally. The <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function minimally requires two: <code>url</code> and <code>destfile</code>. That is the file to download and the location where it is to be saved to disk.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Download .zip file and write to disk</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/packages/corpora/switchboard.zip"</span>,
    destfile <span class="op">=</span> <span class="st">"../data/original/switchboard.zip"</span><span class="op">)</span></code></pre></div>
<p>As we can see looking at the directory structure for <code>data/</code> the <code>switchboard.zip</code> file has been downloaded.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="acquire-data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb8-2"><a href="acquire-data.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb8-3"><a href="acquire-data.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb8-4"><a href="acquire-data.html#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> switchboard.zip</span></code></pre></div>
<p>Once an archive file is downloaded, however, the file needs to be ‘decompressed’ to reveal the file structure. To decompress this file we use the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function with the arguments <code>zipfile</code> pointing to the <code>.zip</code> file and <code>exdir</code> specifying the directory where we want the files to be extracted to.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Decompress .zip file and extract to our target directory</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="st">"../data/original/switchboard.zip"</span>, exdir <span class="op">=</span> <span class="st">"../data/original/"</span><span class="op">)</span></code></pre></div>
<p>The directory structure of <code>data/</code> now should look like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="acquire-data.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb10-2"><a href="acquire-data.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb10-3"><a href="acquire-data.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb10-4"><a href="acquire-data.html#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> switchboard</span>
<span id="cb10-5"><a href="acquire-data.html#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── README</span>
<span id="cb10-6"><a href="acquire-data.html#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── discourse</span>
<span id="cb10-7"><a href="acquire-data.html#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── disfluency</span>
<span id="cb10-8"><a href="acquire-data.html#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── tagged</span>
<span id="cb10-9"><a href="acquire-data.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── timed-transcript</span>
<span id="cb10-10"><a href="acquire-data.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcript</span>
<span id="cb10-11"><a href="acquire-data.html#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> switchboard.zip</span></code></pre></div>
<p>At this point we have acquired the data programmatically and with this code as part of our workflow anyone could run this code and reproduce the same results. The code as it is, however, is not ideally efficient. Firstly the <code>switchboard.zip</code> file is not strictly needed after we decompress it and it occupies disk space if we keep it. And second, each time we run this code the file will be downloaded from the remote serve leading to unnecessary data transfer and server traffic. Let’s tackle each of these issues in turn.</p>
<p>To avoid writing the <code>switchboard.zip</code> file to disk (long-term) we can use the <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code> function to open a temporary holding space for the file. This space can then be used to store the file, unzip it, and then the temporary file will be destroyed. We assign the temporary space to an R object we will name <code>temp</code> with the <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code> function. This object can now be used as the value of the argument <code>destfile</code> in the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function. Let’s also assign the web address to another object <code>url</code> which we will use as the value of the <code>url</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a temporary file space for our .zip file</span>
<span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Assign our web address to `url`</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/packages/corpora/switchboard.zip"</span>
<span class="co"># Download .zip file and write to disk</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">temp</span><span class="op">)</span></code></pre></div>
<div class="rmdtip">
<p>
In the previous code I’ve used the values stored in the objects <code>url</code> and <code>temp</code> in the <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> function without specifying the argument names –only providing the names of the objects. R will assume that values of a function map to the ordering of the arguments. If your values do not map to ordering of the arguments you are required to specify the argument name and the value. To view the ordering of objects hit <code>TAB</code> after entering the function name or consult the function documentation by prefixing the function name with <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code> and hitting <code>ENTER</code>.
</p>
</div>
<p>At this point our downloaded file is stored temporarily on disk and can be accessed and decompressed to our target directory using <code>temp</code> as the value for the argument <code>zipfile</code> from the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function. I’ve assigned our target directory path to <code>target_dir</code> and used it as the value for the argument <code>exdir</code> to prepare us for the next tweak on our approach.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Assign our target directory to `target_dir`</span>
<span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="st">"../data/original/"</span>
<span class="co"># Decompress .zip file and extract to our target directory</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">temp</span>, exdir <span class="op">=</span> <span class="va">target_dir</span><span class="op">)</span></code></pre></div>
<p>Our directory structure now looks like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="acquire-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb13-2"><a href="acquire-data.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb13-3"><a href="acquire-data.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb13-4"><a href="acquire-data.html#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> switchboard</span>
<span id="cb13-5"><a href="acquire-data.html#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb13-6"><a href="acquire-data.html#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> discourse</span>
<span id="cb13-7"><a href="acquire-data.html#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> disfluency</span>
<span id="cb13-8"><a href="acquire-data.html#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tagged</span>
<span id="cb13-9"><a href="acquire-data.html#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> timed-transcript</span>
<span id="cb13-10"><a href="acquire-data.html#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcript</span></code></pre></div>
<p>The second issue I raised concerns the fact that running this code as part of our project will repeat the download each time. Since we would like to be good citizens and avoid unnecessary traffic on the web it would be nice if our code checked to see if we already have the data on disk and if it exists, then skip the download, if not then download it.</p>
<p>To achieve this we need to introduce two new functions <code>if()</code> and <code><a href="https://rdrr.io/r/base/files2.html">dir.exists()</a></code>. <code><a href="https://rdrr.io/r/base/files2.html">dir.exists()</a></code> takes a path to a directory as an argument and returns the logical value, <code>TRUE</code>, if that directory exists, and <code>FALSE</code> if it does not. <code>if()</code> evaluates logical statements and processes subsequent code based on the logical value it is passed as an argument. Let’s look at a toy example.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">num</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is 1"</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is not 1"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; 1 is 1</span></code></pre></div>
<p>I assigned <code>num</code> to the value <code>1</code> and created a logical evaluation <code>num ==</code> whose result is passed as the argument to <code>if()</code>. If the statement returns <code>TRUE</code> then the code withing the first set of curly braces <code>{...}</code> is run. If <code>num == 1</code> is false, like in the code below, the code withing the braces following the <code>else</code> will be run.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">num</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is 1"</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is not 1"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; 2 is not 1</span></code></pre></div>
<p>The function <code>if()</code> is one of various functions that are called <strong>control statements</strong>. Theses functions provide a lot of power to make dynamic choices as code is run.</p>
<p>Before we get back to our key objective to avoid downloading resources that we already have on disk, let me introduce another strategy to making code more powerful and ultimately more efficient and as well as more legible –the <strong>custom function</strong>. Custom functions are functions that the user writes to create a set of procedures that can be run in similar contexts. I’ve created a custom function named <code>eval_num()</code> below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eval_num</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">num</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is 1"</span><span class="op">)</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">num</span>, <span class="st">"is not 1"</span><span class="op">)</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Let’s take a closer look at what’s going on here. The function <code>function()</code> creates a function in which the user decides what arguments are necessary for the code to perform its task. In this case the only necessary argument is the object to store a numeric value to be evaluated. I’ve called it <code>num</code> because it reflects the name of the object in our toy example, but there is nothing special about this name. It’s only important that the object names be consistently used. I’ve included our previous code (except for the hard-coded assignment of <code>num</code>) inside the curly braces and assigned the entire code chunk to <code>eval_num</code>.</p>
<p>We can now use the function <code>eval_num()</code> to perform the task of evaluating whether a value of <code>num</code> is or is not equal to <code>1</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_num</span><span class="op">(</span>num <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; 1 is 1</span>
<span class="fu">eval_num</span><span class="op">(</span>num <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; 2 is not 1</span>
<span class="fu">eval_num</span><span class="op">(</span>num <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; 3 is not 1</span></code></pre></div>
<p>I’ve put these coding strategies together with our previous code in a custom function I named <code>get_zip_data()</code>. There is a lot going on here. Take a look first and see if you can follow the logic involved given what you now know.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_zip_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url</span>, <span class="va">target_dir</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Function: to download and decompress a .zip file to a target directory</span>

    <span class="co"># Check to see if the data already exists if data does not exist, download/</span>
    <span class="co"># decompress</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">target_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Creating target data directory \n"</span><span class="op">)</span>  <span class="co"># print status message</span>
        <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">target_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># create target data directory</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Downloading data... \n"</span><span class="op">)</span>  <span class="co"># print status message</span>
        <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># create a temporary space for the file to be written to</span>
        <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">temp</span><span class="op">)</span>  <span class="co"># download the data to the temp file</span>
        <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="va">temp</span>, exdir <span class="op">=</span> <span class="va">target_dir</span>, junkpaths <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># decompress the temp file in the target directory</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data downloaded! \n"</span><span class="op">)</span>  <span class="co"># print status message</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="co"># if data exists, don't download it again</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data already exists \n"</span><span class="op">)</span>  <span class="co"># print status message</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
OK. You should have recognized the general steps in this function: the argument <code>url</code> and <code>target_dir</code> specify where to get the data and where to write the decompressed files, the <code>if()</code> statement evaluates whether the data already exists, if not (<code>!dir.exists(target_dir)</code>) then the data is downloaded and decompressed, if it does exist (<code>else</code>) then it is not downloaded.
<div class="rmdtip">
<p>
The prefixed <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> in the logical expression <code><a href="https://rdrr.io/r/base/files2.html">dir.exists(target_dir)</a></code> returns the opposite logical value. This is needed in this case so when the target directory exists, the expression will return <code>FALSE</code>, not <code>TRUE</code>, and therefore not proceed in downloading the resource.
</p>
</div>
<p>There are a couple key tweaks I’ve added that provide some additional functionality. For one I’ve included the function <code><a href="https://rdrr.io/r/base/files2.html">dir.create()</a></code> to create the target directory where the data will be written. I’ve also added an additional argument to the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function, <code>junkpaths = TRUE</code>. Together these additions allow the user to create an arbitrary directory path where the files, and only the files, will be extracted to on our disk. This will discard the containing directory of the <code>.zip</code> file which can be helpful when we want to add multiple <code>.zip</code> files to the same target directory.</p>
<p>A practical scenario where this applies is when we want to download data from a corpus that is contained in multiple <code>.zip</code> files but still maintain these files in a single primary data directory. Take for example the <a href="http://www.linguistics.ucsb.edu/research/santa-barbara-corpus">Santa Barbara Corpus</a>. This corpus resource includes a series of interviews in which there is one <code>.zip</code> file, <code>SBCorpus.zip</code> which contains the <a href="http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/SBCorpus.zip">transcribed interviews</a> and another <code>.zip</code> file, <code>metadata.zip</code> which organizes the <a href="http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/metadata.zip">meta-data</a> associated with each speaker. Applying our initial strategy to download and decompress the data will lead to the following directory structure:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="acquire-data.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb19-2"><a href="acquire-data.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb19-3"><a href="acquire-data.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb19-4"><a href="acquire-data.html#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> SBCorpus</span>
<span id="cb19-5"><a href="acquire-data.html#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│  </span> ├── TRN</span>
<span id="cb19-6"><a href="acquire-data.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│  </span> └── __MACOSX</span>
<span id="cb19-7"><a href="acquire-data.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│  </span>     └── TRN</span>
<span id="cb19-8"><a href="acquire-data.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> metadata</span>
<span id="cb19-9"><a href="acquire-data.html#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> __MACOSX</span></code></pre></div>
<p>By applying our new custom function <code>get_zip_data()</code> to the transcriptions and then the meta-data we can better organize the data.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Download corpus transcriptions</span>
<span class="fu">get_zip_data</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/SBCorpus.zip"</span>,
    target_dir <span class="op">=</span> <span class="st">"../data/original/sbc/transcriptions/"</span><span class="op">)</span>

<span class="co"># Download corpus meta-data</span>
<span class="fu">get_zip_data</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"http://www.linguistics.ucsb.edu/sites/secure.lsit.ucsb.edu.ling.d7/files/sitefiles/research/SBC/metadata.zip"</span>,
    target_dir <span class="op">=</span> <span class="st">"../data/original/sbc/meta-data/"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="acquire-data.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb21-2"><a href="acquire-data.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb21-3"><a href="acquire-data.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb21-4"><a href="acquire-data.html#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> sbc</span>
<span id="cb21-5"><a href="acquire-data.html#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> meta-data</span>
<span id="cb21-6"><a href="acquire-data.html#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcriptions</span></code></pre></div>
<p>If we add data from other sources we can keep them logical separate and allow our data collection to scale without creating unnecessary complexity. Let’s add the Switchboard Corpus sample using our <code>get_zip_data()</code> function to see this in action.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Download corpus</span>
<span class="fu">get_zip_data</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/nltk/nltk_data/gh-pages/packages/corpora/switchboard.zip"</span>,
    target_dir <span class="op">=</span> <span class="st">"../data/original/scs/"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="acquire-data.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb23-2"><a href="acquire-data.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb23-3"><a href="acquire-data.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb23-4"><a href="acquire-data.html#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sbc</span>
<span id="cb23-5"><a href="acquire-data.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── meta-data</span>
<span id="cb23-6"><a href="acquire-data.html#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcriptions</span>
<span id="cb23-7"><a href="acquire-data.html#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> scs</span>
<span id="cb23-8"><a href="acquire-data.html#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb23-9"><a href="acquire-data.html#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> discourse</span>
<span id="cb23-10"><a href="acquire-data.html#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> disfluency</span>
<span id="cb23-11"><a href="acquire-data.html#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tagged</span>
<span id="cb23-12"><a href="acquire-data.html#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> timed-transcript</span>
<span id="cb23-13"><a href="acquire-data.html#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcript</span></code></pre></div>
<p>At this point we have what we need to continue to the next step in our data analysis project. But before we go, we should do some housekeeping to document and organize this process to make our work reproducible. We will take advantage of the <code>project-template</code> directory structure, seen below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="acquire-data.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb24-2"><a href="acquire-data.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> _pipeline.R</span>
<span id="cb24-3"><a href="acquire-data.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> analysis</span>
<span id="cb24-4"><a href="acquire-data.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 1_acquire_data.Rmd</span>
<span id="cb24-5"><a href="acquire-data.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 2_curate_dataset.Rmd</span>
<span id="cb24-6"><a href="acquire-data.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 3_transform_dataset.Rmd</span>
<span id="cb24-7"><a href="acquire-data.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 4_analyze_dataset.Rmd</span>
<span id="cb24-8"><a href="acquire-data.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 5_generate_article.Rmd</span>
<span id="cb24-9"><a href="acquire-data.html#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── _session-info.Rmd</span>
<span id="cb24-10"><a href="acquire-data.html#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── _site.yml</span>
<span id="cb24-11"><a href="acquire-data.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── index.Rmd</span>
<span id="cb24-12"><a href="acquire-data.html#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── references.bib</span>
<span id="cb24-13"><a href="acquire-data.html#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> data</span>
<span id="cb24-14"><a href="acquire-data.html#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── derived</span>
<span id="cb24-15"><a href="acquire-data.html#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── original</span>
<span id="cb24-16"><a href="acquire-data.html#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── sbc</span>
<span id="cb24-17"><a href="acquire-data.html#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── scs</span>
<span id="cb24-18"><a href="acquire-data.html#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> functions</span>
<span id="cb24-19"><a href="acquire-data.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> output</span>
<span id="cb24-20"><a href="acquire-data.html#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> figures</span>
<span id="cb24-21"><a href="acquire-data.html#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> results</span></code></pre></div>
<p>First it is good practice to separate custom functions from our processing scripts. We can create a file in our <code>functions/</code> directory named <code>acquire_functions.R</code> and add our custom function <code>get_zip_data()</code> there.</p>
<div class="rmdtip">
<p>
Note that that the <code>acquire_functions.R</code> file is an R script, not an Rmarkdown document. Therefore code chunks that are used in <code>.Rmd</code> files are not used, only the R code itself.
</p>
</div>
<p>We then use the <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> function to read that function into our current script to make it available to use as needed. It is good practice to source your functions in the SETUP section of your script.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load custom functions for this project</span>
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../functions/acquire_functions.R"</span><span class="op">)</span></code></pre></div>
<p>In this section, to sum up, we’ve covered how to access, download, and organize data contained in .zip files; the most common format for language data found on repositories and individual sites. This included an introduction to a few key R programming concepts and strategies including using functions, writing custom functions, and controlling program flow with control statements. Our approach was to gather data while also keeping in mind the reproducibility of the code. To this end I introduced programming strategies for avoiding unnecessary web traffic (downloads), scalable directory creation, and data documentation.</p>
<div class="rmdnote">
<p>
The custom function <code>get_zip_data()</code> works with <code>.zip</code> files. There are many other compressed file formats (e.g. <code>.gz</code>, <code>.tar</code>, <code>.tgz</code>), however. In the R package <code>tadr</code> that accompanies this coursebook, a modified version of the <code>get_zip_data()</code> function, <code>get_compressed_data()</code>, extends the same logic to deal with a wider range of compressed file formats, including <code>.zip</code> files.
</p>
<p>
Explore this function’s documentation (<code>?tadr::get_compressed_data()</code>) and/ or view the code (<code><a href="https://rdrr.io/pkg/tadr/man/get_compressed_data.html">tadr::get_compressed_data</a></code>) to better understand this function.
</p>
</div>
</div>
<div id="apis" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> APIs<a class="anchor" aria-label="anchor" href="#apis"><i class="fas fa-link"></i></a>
</h2>
<p>A convenient alternative method for acquiring data in R is through package interfaces to web services. These interfaces are built using R code to make connections with resources on the web through <strong>Automatic Programming Interfaces</strong> (APIs). Websites such as Project Gutenberg, Twitter, Facebook, and many others provide APIs to allow access to their data under certain conditions, some more limiting for data collection than others. Programmers (like you!) in the R community take up the task of wrapping calls to an API with R code to make accessing that data from R possible. For example, <a href="https://CRAN.R-project.org/package=gutenbergr">gutenbergr</a> provides access to Project Gutenberg, <a href="https://CRAN.R-project.org/package=rtweet">rtweet</a> to Twitter, and <a href="https://CRAN.R-project.org/package=Rfacebook">Rfacebook</a> to Facebook.</p>
<p>Using R package interfaces, however, often requires some more knowledge about R objects and functions. Let’s take a look at how to access data from Project Gutenberg through the <code>gutenbergr</code> package. Along the way we will touch upon various functions and concepts that are key to working with the R data types vectors and data frames including filtering and writing tabular data to disk in plain-text format.</p>
<p>To get started let’s install and/ or load the <code>gutenbergr</code> package. If a package is not part of the R base library, we cannot assume that the user will have the package in their library. The standard approach for installing and then loading a package is by using the <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> function and then calling <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"gutenbergr"</span><span class="op">)</span>  <span class="co"># install `gutenbergr` package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/gutenbergr/">gutenbergr</a></span><span class="op">)</span>  <span class="co"># load the `gutenbergr` package</span></code></pre></div>
<p>This approach works just fine, but luck has it that there is an R package for installing and loading packages! The <a href="https://CRAN.R-project.org/package=pacman">pacman</a> package includes a set of functions for managing packages. A very useful one is <code>p_load()</code> which will look for a package on a system, load it if it is found, and install and then load it if it is not found. This helps potentially avoid using unnecessary bandwidth to install packages that may already exist on a user’s system. But, to use <code>pacman</code> we need to include the code to install and load it with the functions <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> and <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>. I’ve included some code that will mimic the behavior of <code>p_load()</code> for installing <code>pacman</code> itself, but as you can see it is not elegant, luckily it’s only used once as we add it to the SETUP section of our master file, <code>_pipeline.R</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load `pacman`. If not installed, install then load.</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman">"pacman"</a></span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman">"pacman"</a></span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now that we have <code>pacman</code> installed and loaded into our R session, let’s use the <code>p_load()</code> function to make sure to install/ load the two packages we will need for the upcoming tasks. If you are following along with the <code>project_template</code>, add this code within the SETUP section of the <code>1_acquire_data.Rmd</code> file.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Script-specific options or packages</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">gutenbergr</span><span class="op">)</span></code></pre></div>
<div class="rmdwarning">
<p>
Note that the arguments <code>tidyverse</code> and <code>gutenbergr</code> are comma-separated but not quoted when using <code>p_load()</code>. When using <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> to install, package names need to be quoted (character strings). <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> can take quotes or no quotes, but only one package at a time.
</p>
</div>
<p>Project Gutenberg provides access to thousands of texts in the public domain. The <code>gutenbergr</code> package contains a set of tables, or <strong>data frames</strong> in R speak, that index the meta-data for these texts broken down by text (<code>gutenberg_metadata</code>), author (<code>gutenberg_authors</code>), and subject (<code>gutenberg_subjects</code>). I’ll use the <code>glimpse()</code> function loaded in the <a href="https://CRAN.R-project.org/package=tidyverse">tidyverse</a> package<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;code&gt;tidyverse&lt;/code&gt; is not a typical package. It is a set of packages: &lt;code&gt;ggplot2&lt;/code&gt;, &lt;code&gt;dplyr&lt;/code&gt;, &lt;code&gt;tidyr&lt;/code&gt;, &lt;code&gt;readr&lt;/code&gt;, &lt;code&gt;purrr&lt;/code&gt;, and &lt;code&gt;tibble&lt;/code&gt;. These packages are all installed/ loaded with &lt;code&gt;tidyverse&lt;/code&gt; and form the backbone for the type of work you will typically do in most analyses.&lt;/p&gt;"><sup>15</sup></a> to summarize the structure of these data frames.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">gutenberg_metadata</span><span class="op">)</span>  <span class="co"># summarize text meta-data</span>
<span class="co">#&gt; Rows: 51,997</span>
<span class="co">#&gt; Columns: 8</span>
<span class="co">#&gt; $ gutenberg_id        &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, …</span>
<span class="co">#&gt; $ title               &lt;chr&gt; NA, "The Declaration of Independence of the United…</span>
<span class="co">#&gt; $ author              &lt;chr&gt; NA, "Jefferson, Thomas", "United States", "Kennedy…</span>
<span class="co">#&gt; $ gutenberg_author_id &lt;int&gt; NA, 1638, 1, 1666, 3, 1, 4, NA, 3, 3, NA, 7, 7, 7,…</span>
<span class="co">#&gt; $ language            &lt;chr&gt; "en", "en", "en", "en", "en", "en", "en", "en", "e…</span>
<span class="co">#&gt; $ gutenberg_bookshelf &lt;chr&gt; NA, "United States Law/American Revolutionary War/…</span>
<span class="co">#&gt; $ rights              &lt;chr&gt; "Public domain in the USA.", "Public domain in the…</span>
<span class="co">#&gt; $ has_text            &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">gutenberg_authors</span><span class="op">)</span>  <span class="co"># summarize authors meta-data</span>
<span class="co">#&gt; Rows: 16,236</span>
<span class="co">#&gt; Columns: 7</span>
<span class="co">#&gt; $ gutenberg_author_id &lt;int&gt; 1, 3, 4, 5, 7, 8, 9, 10, 12, 14, 16, 17, 18, 20, 2…</span>
<span class="co">#&gt; $ author              &lt;chr&gt; "United States", "Lincoln, Abraham", "Henry, Patri…</span>
<span class="co">#&gt; $ alias               &lt;chr&gt; NA, NA, NA, NA, "Dodgson, Charles Lutwidge", NA, "…</span>
<span class="co">#&gt; $ birthdate           &lt;int&gt; NA, 1809, 1736, NA, 1832, NA, 1819, 1860, 1805, 17…</span>
<span class="co">#&gt; $ deathdate           &lt;int&gt; NA, 1865, 1799, NA, 1898, NA, 1891, 1937, 1844, 18…</span>
<span class="co">#&gt; $ wikipedia           &lt;chr&gt; NA, "http://en.wikipedia.org/wiki/Abraham_Lincoln"…</span>
<span class="co">#&gt; $ aliases             &lt;chr&gt; NA, "United States President (1861-1865)/Lincoln, …</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">gutenberg_subjects</span><span class="op">)</span>  <span class="co"># summarize subjects meta-data</span>
<span class="co">#&gt; Rows: 140,173</span>
<span class="co">#&gt; Columns: 3</span>
<span class="co">#&gt; $ gutenberg_id &lt;int&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, …</span>
<span class="co">#&gt; $ subject_type &lt;chr&gt; "lcc", "lcsh", "lcsh", "lcc", "lcc", "lcsh", "lcsh", "lcc…</span>
<span class="co">#&gt; $ subject      &lt;chr&gt; "E201", "United States. Declaration of Independence", "Un…</span></code></pre></div>

<div class="rmdtip">
<p>The <code>gutenberg_metadata</code>, <code>gutenberg_authors</code>, and <code>gutenberg_subjects</code> are periodically updated. To check to see when each data frame was last updated run:</p>
<p><code><a href="https://rdrr.io/r/base/attr.html">attr(gutenberg_metadata, "date_updated")</a></code></p>
</div>
<p>To download the text itself we use the <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function which takes one required argument, <code>gutenberg_id</code>. The <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function is what is known as ‘vectorized,’ that is, it can take a single value or multiple values for the argument <code>gutenberg_id</code>. Vectorization refers to the process of applying a function to each of the elements stored in a <strong>vector</strong> –a primary object type in R. A vector is a grouping of values of one of various types including character (<code>chr</code>), integer (<code>int</code>), double (<code>dbl</code>), and logical (<code>lgl</code>) and a data frame is a grouping of vectors. The <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function takes an integer vector which can be manually added or selected from the <code>gutenberg_metadata</code> or <code>gutenberg_subjects</code> data frames using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator (e.g. <code>gutenberg_metadata$gutenberg_id</code>).</p>
<p>Let’s first add them manually here as a toy example by generating a vector of integers from 1 to 5 assigned to the variable name <code>ids</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>  <span class="co"># integer vector of values 1 to 5</span>
<span class="va">ids</span>
<span class="co">#&gt; [1] 1 2 3 4 5</span></code></pre></div>
<p>To download the works from Project Gutenberg corresponding to the <code>gutenberg_id</code>s 1 to 5, we pass the <code>ids</code> object to the <code><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download()</a></code> function.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">works_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids</span><span class="op">)</span>  <span class="co"># download works with `gutenberg_id` 1-5</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">works_sample</span><span class="op">)</span>  <span class="co"># summarize `works` dataset</span>
<span class="co">#&gt; Rows: 2,959</span>
<span class="co">#&gt; Columns: 2</span>
<span class="co">#&gt; $ gutenberg_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span>
<span class="co">#&gt; $ text         &lt;chr&gt; "December, 1971  [Etext #1]", "", "", "The Project Gutenb…</span></code></pre></div>
<p>Two attributes are returned: <code>gutenberg_id</code> and <code>text</code>. The <code>text</code> column contains values for each line of text (delimited by a carriage return) for each of the 5 works we downloaded. There are many more attributes available from the Project Gutenberg API that can be accessed by passing a character vector of the attribute names to the argument <code>meta_fields</code>. The column names of the <code>gutenberg_metadata</code> data frame contains the available attributes.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span><span class="op">)</span>  <span class="co"># print the column names of the `gutenberg_metadata` data frame</span>
<span class="co">#&gt; [1] "gutenberg_id"        "title"               "author"             </span>
<span class="co">#&gt; [4] "gutenberg_author_id" "language"            "gutenberg_bookshelf"</span>
<span class="co">#&gt; [7] "rights"              "has_text"</span></code></pre></div>
<p>Let’s augment our previous download with the title and author of each of the works. To create a character vector we use the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function, then, quote and delimit the individual elements of the vector with a comma.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># download works with `gutenberg_id` 1-5 including `title` and `author` as</span>
<span class="co"># attributes</span>
<span class="va">works_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids</span>, meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"author"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">works_sample</span><span class="op">)</span>  <span class="co"># summarize dataset</span>
<span class="co">#&gt; Rows: 2,959</span>
<span class="co">#&gt; Columns: 4</span>
<span class="co">#&gt; $ gutenberg_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span>
<span class="co">#&gt; $ text         &lt;chr&gt; "December, 1971  [Etext #1]", "", "", "The Project Gutenb…</span>
<span class="co">#&gt; $ title        &lt;chr&gt; "The Declaration of Independence of the United States of …</span>
<span class="co">#&gt; $ author       &lt;chr&gt; "Jefferson, Thomas", "Jefferson, Thomas", "Jefferson, Tho…</span></code></pre></div>
<p>Now, in a more practical scenario we would like to select the values of <code>gutenberg_id</code> by some principled query such as works from a specific author, language, or subject. To do this we first query either the <code>gutenberg_metadata</code> data frame or the <code>gutenberg_subjects</code> data frame. Let’s say we want to download a random sample of 10 works from English Literature (Library of Congress Classification, “PR”). Using the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function (part of the <code>tidyverse</code> package set) we first extract all the Gutenberg ids from <code>gutenberg_subjects</code> where <code>subject_type == "lcc"</code> and <code>subject == "PR"</code> assigning the result to <code>ids</code>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;See &lt;a href="https://www.loc.gov/catdir/cpso/lcco/"&gt;Library of Congress Classification&lt;/a&gt; documentation for a complete list of subject codes.&lt;/p&gt;'><sup>16</sup></a></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># filter for only English literature</span>
<span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_subjects</span>, <span class="va">subject_type</span> <span class="op">==</span> <span class="st">"lcc"</span>, <span class="va">subject</span> <span class="op">==</span> <span class="st">"PR"</span><span class="op">)</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span>
<span class="co">#&gt; Rows: 7,100</span>
<span class="co">#&gt; Columns: 3</span>
<span class="co">#&gt; $ gutenberg_id &lt;int&gt; 11, 12, 13, 16, 20, 26, 27, 35, 36, 42, 43, 46, 58, 60, 8…</span>
<span class="co">#&gt; $ subject_type &lt;chr&gt; "lcc", "lcc", "lcc", "lcc", "lcc", "lcc", "lcc", "lcc", "…</span>
<span class="co">#&gt; $ subject      &lt;chr&gt; "PR", "PR", "PR", "PR", "PR", "PR", "PR", "PR", "PR", "PR…</span></code></pre></div>
<div class="rmdwarning">
<p>
The operators <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> and <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> are not equivalents. <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> is used for logical evaluation and <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> is an alternate notation for variable assignment (<code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code>).
</p>
</div>
<p>The <code>gutenberg_subjects</code> data frame does not contain information as to whether a <code>gutenberg_id</code> is associated with a plain-text version. To limit our query to only those English Literature works with text, we filter the <code>gutenberg_metadata</code> data frame by the ids we have selected in <code>ids</code> and the attribute <code>has_text</code> in the <code>gutenberg_metadata</code> data frame.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Filter for only those works that have text</span>
<span class="va">ids_has_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span>, <span class="va">gutenberg_id</span> <span class="op">%in%</span> <span class="va">ids</span><span class="op">$</span><span class="va">gutenberg_id</span>, <span class="va">has_text</span> <span class="op">==</span>
    <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">ids_has_text</span><span class="op">)</span>
<span class="co">#&gt; Rows: 6,724</span>
<span class="co">#&gt; Columns: 8</span>
<span class="co">#&gt; $ gutenberg_id        &lt;int&gt; 11, 12, 13, 16, 20, 26, 27, 35, 36, 42, 43, 46, 58…</span>
<span class="co">#&gt; $ title               &lt;chr&gt; "Alice's Adventures in Wonderland", "Through the L…</span>
<span class="co">#&gt; $ author              &lt;chr&gt; "Carroll, Lewis", "Carroll, Lewis", "Carroll, Lewi…</span>
<span class="co">#&gt; $ gutenberg_author_id &lt;int&gt; 7, 7, 7, 10, 17, 17, 23, 30, 30, 35, 35, 37, 17, 4…</span>
<span class="co">#&gt; $ language            &lt;chr&gt; "en", "en", "en", "en", "en", "en", "en", "en", "e…</span>
<span class="co">#&gt; $ gutenberg_bookshelf &lt;chr&gt; "Children's Literature", "Children's Literature/Be…</span>
<span class="co">#&gt; $ rights              &lt;chr&gt; "Public domain in the USA.", "Public domain in the…</span>
<span class="co">#&gt; $ has_text            &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…</span></code></pre></div>

<div class="rmdtip">
A couple R programming notes on the code phrase <code>gutenberg_id %in% ids$gutenberg_id</code>. First, the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> symbol in <code>ids$gutenberg_id</code> is the programmatic way to target a particular column in an R data frame. In this example we select the <code>ids</code> data frame and the column <code>gutenberg_id</code>, which is a integer vector. The <code>gutenberg_id</code> variable that precedes the <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> operator does not need an explicit reference to a data frame because the primary argument of the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function is this data frame (<code>gutenberg_metadata</code>). Second, the <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> operator logically evaluates whether the vector elements in <code>gutenberg_metadata$gutenberg_ids</code> are also found in the vector <code>ids$gutenberg_id</code> returning <code>TRUE</code> and <code>FALSE</code> accordingly. This effectively filters those ids which are not in both vectors.
</div>
<p>As we can see the number of works with text is fewer than the number of works listed, 7100 versus 6724. Now we can safely do our random selection of 10 works, with the function <code>slice_sample()</code> and be confident that the ids we select will contain text when we take the next step by downloading the data.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># make the sampling reproducible</span>
<span class="va">ids_sample</span> <span class="op">&lt;-</span> <span class="fu">slice_sample</span><span class="op">(</span><span class="va">ids_has_text</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>  <span class="co"># sample 10 works</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">ids_sample</span><span class="op">)</span>  <span class="co"># summarize the dataset</span>
<span class="co">#&gt; Rows: 10</span>
<span class="co">#&gt; Columns: 8</span>
<span class="co">#&gt; $ gutenberg_id        &lt;int&gt; 10564, 10784, 9316, 1540, 24450, 13821, 7595, 3818…</span>
<span class="co">#&gt; $ title               &lt;chr&gt; "Fairy Gold\nShip's Company, Part 4.", "Sentence D…</span>
<span class="co">#&gt; $ author              &lt;chr&gt; "Jacobs, W. W. (William Wymark)", "Jacobs, W. W. (…</span>
<span class="co">#&gt; $ gutenberg_author_id &lt;int&gt; 1865, 1865, 2364, 65, 999, 2685, 761, 1317, 3564, …</span>
<span class="co">#&gt; $ language            &lt;chr&gt; "en", "en", "en", "en", "en", "en", "en", "en", "e…</span>
<span class="co">#&gt; $ gutenberg_bookshelf &lt;chr&gt; NA, NA, NA, NA, "Adventure", "Fantasy", NA, NA, NA…</span>
<span class="co">#&gt; $ rights              &lt;chr&gt; "Public domain in the USA.", "Public domain in the…</span>
<span class="co">#&gt; $ has_text            &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">works_pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids_sample</span><span class="op">$</span><span class="va">gutenberg_id</span>, meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"author"</span>,
    <span class="st">"title"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">works_pr</span><span class="op">)</span>  <span class="co"># summarize the dataset</span>
<span class="co">#&gt; Rows: 47,515</span>
<span class="co">#&gt; Columns: 4</span>
<span class="co">#&gt; $ gutenberg_id &lt;int&gt; 1540, 1540, 1540, 1540, 1540, 1540, 1540, 1540, 1540, 154…</span>
<span class="co">#&gt; $ text         &lt;chr&gt; "cover ", "", "", "", "THE TEMPEST", "", "", "", "by Will…</span>
<span class="co">#&gt; $ author       &lt;chr&gt; "Shakespeare, William", "Shakespeare, William", "Shakespe…</span>
<span class="co">#&gt; $ title        &lt;chr&gt; "The Tempest", "The Tempest", "The Tempest", "The Tempest…</span></code></pre></div>
<p>At this point we have data and could move on to processing this data in preparation for analysis. However, we are aiming for a reproducible workflow and this code does not conform to our principle of modularity: each subsequent step in our analysis will depend on running this code first. Furthermore, running this code as it is creates issues with bandwidth, as in our previous examples from direct downloads. To address modularity we will write the data to disk in <strong>plain-text format</strong>. In this way each subsequent step in our analysis can access the data locally. To address bandwidth concerns, we will devise a method for checking to see if the data is already downloaded and skip the download, if possible, to avoid accessing the Project Gutenberg server unnecessarily.</p>
<p>To write our data frame to disk we will export it into a standard plain-text format for two-dimensional data: a CSV file (comma-separated value). The CSV structure for this data will look like this:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">works_pr</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">format_csv</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; gutenberg_id,text,author,title</span>
<span class="co">#&gt; 1540,cover ,"Shakespeare, William",The Tempest</span>
<span class="co">#&gt; 1540,,"Shakespeare, William",The Tempest</span>
<span class="co">#&gt; 1540,,"Shakespeare, William",The Tempest</span>
<span class="co">#&gt; 1540,,"Shakespeare, William",The Tempest</span>
<span class="co">#&gt; 1540,THE TEMPEST,"Shakespeare, William",The Tempest</span>
<span class="co">#&gt; 1540,,"Shakespeare, William",The Tempest</span></code></pre></div>
<p>The first line contains the names of the columns and subsequent lines the observations. Data points that contain commas themselves (e.g. “Shaw, Bernard”) are quoted to avoid misinterpreting these commas a deliminators in our data. To write this data to disk we will use the <code>write_csv()</code> function.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">write_csv</span><span class="op">(</span><span class="va">works_pr</span>, file <span class="op">=</span> <span class="st">"../data/original/gutenberg_works_pr.csv"</span><span class="op">)</span></code></pre></div>
<p>To avoid downloading data that already resides on disk, let’s implement a similar strategy to the one used for direct downloads (<code>get_zip_data()</code>). I’ve incorporated the code for sampling and downloading data for a particular subject from Project Gutenberg with a control statement to check if the data file already exists into a function I named <code>get_gutenberg_subject()</code>. Take a look at this function below.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_gutenberg_subject</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subject</span>, <span class="va">target_file</span>, <span class="va">sample_size</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Function: to download texts from Project Gutenberg with </span>
  <span class="co"># a specific LCC subject and write the data to disk.</span>
  
  <span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">gutenbergr</span><span class="op">)</span> <span class="co"># install/load necessary packages</span>
  
  <span class="co"># Check to see if the data already exists</span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># if data does not exist, download and write</span>
    <span class="va">target_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span><span class="op">(</span><span class="va">target_file</span><span class="op">)</span> <span class="co"># generate target directory for the .csv file</span>
    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">target_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># create target data directory</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Downloading data... \n"</span><span class="op">)</span> <span class="co"># print status message</span>
    <span class="co"># Select all records with a particular LCC subject</span>
    <span class="va">ids</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_subjects</span>, 
             <span class="va">subject_type</span> <span class="op">==</span> <span class="st">"lcc"</span>, <span class="va">subject</span> <span class="op">==</span> <span class="va">subject</span><span class="op">)</span> <span class="co"># select subject</span>
    <span class="co"># Select only those records with plain text available</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># make the sampling reproducible</span>
    <span class="va">ids_sample</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gutenberg_metadata</span>, 
             <span class="va">gutenberg_id</span> <span class="op">%in%</span> <span class="va">ids</span><span class="op">$</span><span class="va">gutenberg_id</span>, <span class="co"># select ids in both data frames </span>
             <span class="va">has_text</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># select those ids that have text</span>
      <span class="fu">slice_sample</span><span class="op">(</span><span class="va">sample_size</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># sample N works </span>
    <span class="co"># Download sample with associated `author` and `title` metadata</span>
    <span class="va">works_sample</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://docs.ropensci.org/gutenbergr/reference/gutenberg_download.html">gutenberg_download</a></span><span class="op">(</span>gutenberg_id <span class="op">=</span> <span class="va">ids_sample</span><span class="op">$</span><span class="va">gutenberg_id</span>, 
                         meta_fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"author"</span>, <span class="st">"title"</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># Write the dataset to disk in .csv format</span>
    <span class="fu">write_csv</span><span class="op">(</span><span class="va">works_sample</span>, file <span class="op">=</span> <span class="va">target_file</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data downloaded! \n"</span><span class="op">)</span> <span class="co"># print status message</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># if data exists, don't download it again</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Data already exists \n"</span><span class="op">)</span> <span class="co"># print status message</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Adding this function to our function script <code>functions/acquire_functions.R</code>, we can now source this function in our <code>analysis/1_acquire_data.Rmd</code> script to download multiple subjects and store them in on disk in their own file.</p>
<p>Let’s download American Literature now (LCC code “PQ”).</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Download Project Gutenberg text for subject 'PQ' (American Literature) and</span>
<span class="co"># then write this dataset to disk in .csv format</span>
<span class="fu">get_gutenberg_subject</span><span class="op">(</span>subject <span class="op">=</span> <span class="st">"PQ"</span>, target_file <span class="op">=</span> <span class="st">"../data/original/gutenberg/works_pq.csv"</span><span class="op">)</span></code></pre></div>
<p>Applying this function to both the English and American Literature datasets, our data directory structure now looks like this:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="acquire-data.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span></span>
<span id="cb42-2"><a href="acquire-data.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived</span>
<span id="cb42-3"><a href="acquire-data.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original</span>
<span id="cb42-4"><a href="acquire-data.html#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> gutenberg</span>
<span id="cb42-5"><a href="acquire-data.html#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── works_pq.csv</span>
<span id="cb42-6"><a href="acquire-data.html#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── works_pr.csv</span>
<span id="cb42-7"><a href="acquire-data.html#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> sbc</span>
<span id="cb42-8"><a href="acquire-data.html#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── meta-data</span>
<span id="cb42-9"><a href="acquire-data.html#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── transcriptions</span>
<span id="cb42-10"><a href="acquire-data.html#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> scs</span>
<span id="cb42-11"><a href="acquire-data.html#cb42-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb42-12"><a href="acquire-data.html#cb42-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> discourse</span>
<span id="cb42-13"><a href="acquire-data.html#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> disfluency</span>
<span id="cb42-14"><a href="acquire-data.html#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> documentation</span>
<span id="cb42-15"><a href="acquire-data.html#cb42-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> tagged</span>
<span id="cb42-16"><a href="acquire-data.html#cb42-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> timed-transcript</span>
<span id="cb42-17"><a href="acquire-data.html#cb42-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> transcript</span></code></pre></div>
<p>In sum, this subsection provided an overview to acquiring data from web service APIs through R packages. We took at closer look at the <code>gutenbergr</code> package which provides programmatic access to works available on Project Gutenberg. Working with package interfaces requires more knowledge of R including loading/ installing packages, working with vectors and data frames, and exporting data from an R session. We touched on these programming concepts and also outlined a method to create a reproducible workflow.</p>
<!-- Consider:

- TBDBr package for getting the BELC data
- rtweet package for getting tweet data (Corona virus?)

-->
</div>
<div id="web-scraping" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Web scraping<a class="anchor" aria-label="anchor" href="#web-scraping"><i class="fas fa-link"></i></a>
</h2>
<p>There are many resources available through direct downloads from repositories and individual sites and R package interfaces to web resources with APIs, but these resources are relatively limited to the amount of public-facing textual data recorded on the web. In the case that you want to acquire data from webpages R can be used to access the web programmatically through a process known as web scraping. The complexity of web scrapes can vary but in general it requires more advanced knowledge of R as well as the structure of the language of the web: HTML (Hypertext Markup Language).</p>
</div>
<div id="documentation-1" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Documentation<a class="anchor" aria-label="anchor" href="#documentation-1"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="preparation-overview.html">Overview</a></div>
<div class="next"><a href="curate-data.html"><span class="header-section-number">6</span> Curate data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#acquire-data"><span class="header-section-number">5</span> Acquire data</a></li>
<li><a class="nav-link" href="#direct-downloads"><span class="header-section-number">5.1</span> Direct downloads</a></li>
<li><a class="nav-link" href="#apis"><span class="header-section-number">5.2</span> APIs</a></li>
<li><a class="nav-link" href="#web-scraping"><span class="header-section-number">5.3</span> Web scraping</a></li>
<li><a class="nav-link" href="#documentation-1"><span class="header-section-number">5.4</span> Documentation</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/lin380/coursebook/blob/master/06-acquire-data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/lin380/coursebook/edit/master/06-acquire-data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Coursebook</strong>: Text as Data: An introduction to quantative text analysis and reproducible research with R" was written by Jerid Francom. It was last built on July 24, 2021 (latest version).</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
